<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' gkp: gkps:; img-src 'self' data: gkp: gkps: https:; style-src 'self' 'unsafe-inline' gkp: gkps:; font-src 'self' gkp: gkps: data:; script-src 'self' 'unsafe-inline' 'unsafe-eval';">
  <title>Gekko Browser - Home</title>
  <link rel="stylesheet" href="gkp://shared.gekko/theme-vars.css" />
  <link rel="stylesheet" href="gkp://shared.gekko/styles.css" />
  <link rel="stylesheet" href="gkp://shared.gekko/button-styles.css" />
  <link rel="stylesheet" href="gkp://shared.gekko/category-styles.css" />
  <link rel="stylesheet" href="gkp://shared.gekko/home-shortcuts.css" />
  <link rel="stylesheet" href="gkp://shared.gekko/fontawesome/all.min.css" />
  <script src="gkp://shared.gekko/theme-utils.js"></script>
  <script src="gkp://shared.gekko/webview-navigation-helper.js"></script>
</head>
<body>
  <div class="internal-page">
    <div class="internal-page-header">
      <h1 class="internal-page-title">Welcome to Gekko Browser</h1>
      <p class="internal-page-subtitle">A lightweight, experimental web browser with GKP protocol support</p>
    </div>
    <div class="internal-page-content">
      <div class="search-container">
        <div class="search-box">
          <i class="fa-solid fa-magnifying-glass search-icon"></i>
          <input type="text" class="search-input" id="search-input" placeholder="Search the web..." autofocus>
          <select class="search-engine-select" id="search-engine-select">
            <option value="https://www.google.com/search?q=">Google</option>
            <option value="https://www.bing.com/search?q=">Bing</option>
            <option value="https://duckduckgo.com/?q=">DuckDuckGo</option>
            <option value="https://search.yahoo.com/search?p=">Yahoo</option>
          </select>
        </div>
      </div>
      
      <!-- Popular Sites Category -->
      <h2 class="shortcut-category">Popular Sites</h2>
      <div class="home-grid" id="popular-sites">
        <div class="home-shortcut" data-url="https://github.com">
          <div class="shortcut-icon">
            <i class="fa-brands fa-github"></i>
          </div>
          <div class="shortcut-title">GitHub</div>
        </div>
        
        <div class="home-shortcut" data-url="https://google.com">
          <div class="shortcut-icon">
            <i class="fa-brands fa-google"></i>
          </div>
          <div class="shortcut-title">Google</div>
        </div>
        
        <div class="home-shortcut" data-url="https://youtube.com">
          <div class="shortcut-icon">
            <i class="fa-brands fa-youtube"></i>
          </div>
          <div class="shortcut-title">YouTube</div>
        </div>
        
        <div class="home-shortcut" data-url="https://twitter.com">
          <div class="shortcut-icon">
            <i class="fa-brands fa-twitter"></i>
          </div>
          <div class="shortcut-title">Twitter</div>
        </div>
        
        <div class="home-shortcut" data-url="https://reddit.com">
          <div class="shortcut-icon">
            <i class="fa-brands fa-reddit"></i>
          </div>
          <div class="shortcut-title">Reddit</div>
        </div>
        
        <div class="home-shortcut" data-url="https://linkedin.com">
          <div class="shortcut-icon">
            <i class="fa-brands fa-linkedin"></i>
          </div>
          <div class="shortcut-title">LinkedIn</div>
        </div>
      </div>
      
      <!-- Gekko Browser Category -->
      <h2 class="shortcut-category">Gekko Browser</h2>
      <div class="home-grid" id="gekko-sites">
        <div class="home-shortcut" data-url="gkp://about.gekko/">
          <div class="shortcut-icon">
            <i class="fa-solid fa-info-circle"></i>
          </div>
          <div class="shortcut-title">About Gekko</div>
        </div>
        
        <div class="home-shortcut" data-url="gkps://secure.gekko/">
          <div class="shortcut-icon">
            <i class="fa-solid fa-shield"></i>
          </div>
          <div class="shortcut-title">Secure Demo</div>
        </div>
        
        <div class="home-shortcut" data-url="gkp://settings.gekko/">
          <div class="shortcut-icon">
            <i class="fa-solid fa-gear"></i>
          </div>
          <div class="shortcut-title">Settings</div>
        </div>
        
        <div class="home-shortcut" data-url="gkp://history.gekko/">
          <div class="shortcut-icon">
            <i class="fa-solid fa-clock-rotate-left"></i>
          </div>
          <div class="shortcut-title">History</div>
        </div>
        
        <div class="home-shortcut" data-url="gkp://protocols.gekko/">
          <div class="shortcut-icon">
            <i class="fa-solid fa-book"></i>
          </div>
          <div class="shortcut-title">Protocols</div>
        </div>
      </div>
      
      <!-- Tools & Utilities Category -->
      <h2 class="shortcut-category">Tools & Utilities</h2>
      <div class="home-grid" id="tools-sites">
        <div class="home-shortcut" data-url="https://translate.google.com">
          <div class="shortcut-icon">
            <i class="fa-solid fa-language"></i>
          </div>
          <div class="shortcut-title">Translate</div>
        </div>
        
        <div class="home-shortcut" data-url="https://drive.google.com">
          <div class="shortcut-icon">
            <i class="fa-brands fa-google-drive"></i>
          </div>
          <div class="shortcut-title">Google Drive</div>
        </div>
        
        <div class="home-shortcut" data-url="https://maps.google.com">
          <div class="shortcut-icon">
            <i class="fa-solid fa-map"></i>
          </div>
          <div class="shortcut-title">Maps</div>
        </div>
        
        <div class="home-shortcut" data-url="https://calendar.google.com">
          <div class="shortcut-icon">
            <i class="fa-solid fa-calendar"></i>
          </div>
          <div class="shortcut-title">Calendar</div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Initialize search functionality
    const searchInput = document.getElementById('search-input');
    const searchEngineSelect = document.getElementById('search-engine-select');
    
    // Apply theme using the shared theme utilities
    if (typeof applyThemeStyles === 'function') {
      applyThemeStyles();
    }
    
    // Fix FontAwesome icons if they're not loading properly
    if (window.browserAction && typeof window.browserAction.fixIcons === 'function') {
      console.log('Fixing icons on homepage');
      window.browserAction.fixIcons();
    }
    
    // Get settings and initialize search engine
    try {
      if (window.parent && window.parent.api && window.parent.api.getSettings) {
        const settings = window.parent.api.getSettings();
        if (settings && settings.searchEngine) {
          searchEngineSelect.value = settings.searchEngine;
        }
      }
    } catch (error) {
      console.error('Error loading settings:', error);
    }
    
    // Handle search
    function handleSearch() {
      const query = searchInput.value.trim();
      if (query) {
        const searchEngine = searchEngineSelect.value;
        const searchUrl = searchEngine + encodeURIComponent(query);
        console.log('Sending navigation message:', searchUrl);
        
        try {
          // Use browserAction API if available
          if (window.browserAction && typeof window.browserAction.navigate === 'function') {
            window.browserAction.navigate(searchUrl);
            searchInput.value = ''; // Clear the search input after search
            return;
          }
          
          // Direct approach - access webview parent
          if (window.parent && window.parent.handleNavigation) {
            window.parent.handleNavigation(searchUrl);
            searchInput.value = ''; // Clear the search input after search
            return;
          }
          
          // Try postMessage approach
          window.parent.postMessage({ type: 'navigate', url: searchUrl }, '*');
          
          // Add direct DOM navigation as a more aggressive fallback
          const webview = window.frameElement;
          if (webview && webview.loadURL) {
            webview.loadURL(searchUrl);
          } else if (window.parent && window.parent.location) {
            window.parent.location.href = searchUrl;
          }
          
          searchInput.value = ''; // Clear the search input after search
        } catch (error) {
          console.error('Error during search navigation:', error);
          // Last resort fallback
          window.open(searchUrl, '_blank');
        }
      }
    }
    
    // Listen for Enter key in search input
    searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        handleSearch();
      }
    });
    
    // Save search engine preference when changed
    searchEngineSelect.addEventListener('change', () => {
      try {
        if (window.parent && window.parent.api && window.parent.api.setSetting) {
          window.parent.api.setSetting('searchEngine', searchEngineSelect.value);
        }
      } catch (error) {
        console.error('Error saving search engine preference:', error);
      }
    });
    
    // Initialize shortcut navigation
    document.querySelectorAll('.home-shortcut').forEach(shortcut => {
      shortcut.addEventListener('click', (e) => {
        e.preventDefault();
        const url = shortcut.getAttribute('data-url');
        if (url) {
          console.log('Shortcut clicked, navigating to:', url);
          
          try {
            // Use browserAction API if available
            if (window.browserAction && typeof window.browserAction.navigate === 'function') {
              window.browserAction.navigate(url);
              return;
            }
            
            // Direct approach - access webview parent
            if (window.parent && window.parent.handleNavigation) {
              window.parent.handleNavigation(url);
              return;
            }
            
            // Try postMessage approach
            window.parent.postMessage({ type: 'navigate', url: url }, '*');
            
            // Add direct DOM navigation as a more aggressive fallback
            const webview = window.frameElement;
            if (webview && webview.loadURL) {
              webview.loadURL(url);
            } else if (window.parent && window.parent.location) {
              window.parent.location.href = url;
            }
          } catch (error) {
            console.error('Error during shortcut navigation:', error);
            // Last resort fallback
            window.open(url, '_blank');
          }
        }
      });
      
      // Add hover animation class
      shortcut.classList.add('animated-shortcut');
    });
  </script>
</body>
</html>